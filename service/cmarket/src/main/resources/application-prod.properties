spring.application.name=cmarket_api

# JWT 설정 (보안: 환경 변수로 관리 필수)
# ⚠️ CRITICAL: 운영 환경에서는 반드시 환경 변수로 주입해야 합니다.
# HS256 알고리즘에 적합한 32바이트 이상의 임의 문자열 사용
jwt.secret=${JWT_SECRET:your-secret-key-must-be-at-least-256-bits-long-for-hmac-sha-algorithms-please-change-this-in-production}
jwt.access-token-validity-in-seconds=21600
jwt.refresh-token-validity-in-seconds=604800

# 이메일 설정
# 운영 환경: 실제 SMTP 서버 설정 필요
# spring.mail.host=smtp.gmail.com
# spring.mail.port=587
# spring.mail.username=${MAIL_USERNAME:your-email@gmail.com}
# spring.mail.password=${MAIL_PASSWORD:your-app-password}
# spring.mail.properties.mail.smtp.auth=true
# spring.mail.properties.mail.smtp.starttls.enable=true

# MariaDB (AWS RDS)
# 환경 변수로 오버라이드 가능: DB_URL, DB_USER, DB_PASS
# ⚠️ 중요: DB_URL에 문자셋 파라미터가 포함되어 있지 않다면 자동으로 추가됩니다.
# 기본값에 utf8mb4 문자셋 파라미터 포함
spring.datasource.url=${DB_URL:jdbc:mariadb://localhost:3306/cmarket?characterEncoding=utf8mb4&useUnicode=true&connectionCollation=utf8mb4_general_ci}
spring.datasource.driver-class-name=org.mariadb.jdbc.Driver
spring.datasource.username=${DB_USER:admin}
spring.datasource.password=${DB_PASS:}

# HikariCP 커넥션 풀 설정 (커넥션 타임아웃 문제 해결)
# 최대 풀 크기: 기본값 10에서 20으로 증가
spring.datasource.hikari.maximum-pool-size=20
# 최소 유휴 커넥션: 기본값과 동일하게 유지
spring.datasource.hikari.minimum-idle=5
# 커넥션 타임아웃: 30초에서 60초로 증가
spring.datasource.hikari.connection-timeout=60000
# 커넥션 유효성 검사: 커넥션 사용 전 유효성 확인
spring.datasource.hikari.connection-test-query=SELECT 1
# 유휴 커넥션 타임아웃: 10분 동안 사용되지 않은 커넥션은 제거
spring.datasource.hikari.idle-timeout=600000
# 커넥션 최대 수명: 30분 후 커넥션 교체 (누수 방지)
spring.datasource.hikari.max-lifetime=1800000
# 커넥션 누수 감지: 60초 이상 사용 중인 커넥션 감지
spring.datasource.hikari.leak-detection-threshold=60000
# 자동 커밋: false로 설정하여 트랜잭션 관리
spring.datasource.hikari.auto-commit=false

# H2 콘솔 비활성화 (프로덕션 환경에서는 MariaDB 사용)
spring.h2.console.enabled=false

# JPA
# 운영 환경에서는 validate 또는 none 고려
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MariaDBDialect

# SQL 초기화 설정
# 배포 환경에서는 never로 변경 권장 (초기 데이터 구축 완료 후)
spring.sql.init.mode=never
spring.jpa.defer-datasource-initialization=false

# OAuth2
# ⚠️ CRITICAL: Client Secret이 코드에 노출되면 보안 사고로 이어질 수 있습니다.
# 반드시 환경 변수로 관리하거나 배포 시에만 주입해야 합니다.
# Google OAuth2
spring.security.oauth2.client.registration.google.client-id=${GOOGLE_CLIENT_ID:your-google-client-id}
spring.security.oauth2.client.registration.google.client-secret=${GOOGLE_CLIENT_SECRET:your-google-client-secret}
spring.security.oauth2.client.registration.google.scope=profile,email
spring.security.oauth2.client.registration.google.redirect-uri={baseUrl}/login/oauth2/code/{registrationId}

# Kakao OAuth2
spring.security.oauth2.client.registration.kakao.client-id=${KAKAO_CLIENT_ID:your-kakao-client-id}
spring.security.oauth2.client.registration.kakao.client-secret=${KAKAO_CLIENT_SECRET:your-kakao-client-secret}
spring.security.oauth2.client.registration.kakao.authorization-grant-type=authorization_code
spring.security.oauth2.client.registration.kakao.client-authentication-method=client_secret_post
spring.security.oauth2.client.registration.kakao.redirect-uri={baseUrl}/login/oauth2/code/{registrationId}
spring.security.oauth2.client.registration.kakao.scope=profile_nickname
spring.security.oauth2.client.registration.kakao.client-name=Kakao
spring.security.oauth2.client.provider.kakao.authorization-uri=https://kauth.kakao.com/oauth/authorize
spring.security.oauth2.client.provider.kakao.token-uri=https://kauth.kakao.com/oauth/token
spring.security.oauth2.client.provider.kakao.user-info-uri=https://kapi.kakao.com/v2/user/me
spring.security.oauth2.client.provider.kakao.user-name-attribute=id

# OAuth2 리다이렉트 URL (환경 변수로 관리, 기본값은 프론트엔드 프로덕션 주소)
# Docker 배포: 환경 변수 OAUTH2_REDIRECT_URI로 설정
oauth2.redirect-uri=${OAUTH2_REDIRECT_URI:https://cuddle-market.duckdns.org//oauth-redirect}

# AWS S3 설정
# ⚠️ CRITICAL: 운영 환경에서는 반드시 환경 변수로 주입해야 합니다.
aws.s3.bucket-name=${AWS_S3_BUCKET_NAME:cmarket-images}
aws.s3.region=${AWS_REGION:ap-northeast-2}
aws.s3.access-key=${AWS_ACCESS_KEY_ID:}
aws.s3.secret-key=${AWS_SECRET_ACCESS_KEY:}
# AWS 자격 증명은 환경 변수(AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY) 또는
# ~/.aws/credentials 파일을 통해 자동으로 인식됩니다.
# 위의 aws.s3.access-key와 aws.s3.secret-key는 사용하지 않을 수 있습니다.

# 이미지 업로드 설정 (S3 사용 시 더 이상 사용하지 않음 - 하위 호환성을 위해 유지)
# app.image.upload-dir=${IMAGE_UPLOAD_DIR:./uploads/images}
# app.image.base-url=/api/images
# app.image.server-url=${APP_IMAGE_SERVER_URL:http://localhost:8080}

# 멀티파트 업로드 제한
spring.servlet.multipart.max-file-size=5MB
spring.servlet.multipart.max-request-size=5MB

# Redis 설정 (Docker Compose 서비스 이름으로 변경)
# EC2에서 직접 실행 시 localhost로 변경
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
# spring.data.redis.password=${REDIS_PASSWORD:}  # 운영 환경에서 설정

# 채팅 관련 설정
chat.redis.ttl-days=30

server.forward-headers-strategy=native

