# 카카오 로그인 동의 항목 설정 가이드

> 카카오 로그인에서 "설정하지 않은 동의 항목: account_email" 에러 해결 방법

---

## 문제 상황

카카오 로그인을 시도할 때 다음과 같은 400 에러가 발생하는 경우:

```
설정하지 않은 카카오 로그인 동의 항목을 포함해 인가 코드를 요청했습니다.
설정하지 않은 동의 항목: account_email
```

이는 카카오 개발자 콘솔에서 `account_email` 동의 항목이 활성화되지 않았기 때문입니다.

---

## 해결 방법

### 방법 1: 카카오 개발자 콘솔에서 동의 항목 활성화 (권장)

1. **카카오 개발자 콘솔 접속**
   - [https://developers.kakao.com/](https://developers.kakao.com/) 접속
   - 로그인 후 "내 애플리케이션" 선택

2. **애플리케이션 선택**
   - 카카오 로그인을 사용할 애플리케이션 선택

3. **동의 항목 설정으로 이동**
   - 왼쪽 메뉴: **"제품 설정"** > **"카카오 로그인"** > **"동의 항목"** 클릭

4. **이메일 동의 항목 활성화**
   - **"개인정보"** 섹션으로 스크롤
   - **"카카오 계정(이메일)"** 항목 찾기
   - **"동의 단계"** 열에서 다음 중 하나 선택:
     - **"선택 동의"**: 사용자가 선택적으로 이메일 제공 가능
     - **"필수 동의"**: 사용자가 반드시 이메일 제공해야 함 (비즈니스 앱만 가능)

5. **저장**
   - 설정 변경 후 저장
   - 변경사항이 반영되는데 몇 분 정도 소요될 수 있음

6. **테스트**
   - 브라우저에서 `http://localhost:8080/oauth2/authorization/kakao` 접근
   - 에러가 해결되었는지 확인

---

### 방법 2: scope에서 account_email 제거 (이메일 불필요한 경우)

만약 이메일이 필수가 아니라면, scope에서 `account_email`을 제거할 수 있습니다.

1. **application.properties 수정**
   ```properties
   # 기존
   spring.security.oauth2.client.registration.kakao.scope=profile_nickname,account_email
   
   # 수정 후 (이메일 제거)
   spring.security.oauth2.client.registration.kakao.scope=profile_nickname
   ```

2. **코드 수정 필요**
   - `CustomOAuth2UserService`에서 이메일이 없어도 로그인 가능하도록 수정
   - 이메일 대신 다른 식별자(소셜 ID 등)를 사용하도록 변경
   - **주의**: 현재 구현은 이메일이 필수이므로, 이 방법을 사용하려면 코드 수정이 필요합니다.

---

## 일반 웹페이지 로그인 vs 비즈니스 앱

### 일반 웹페이지 로그인
- 이메일을 **선택 동의**로만 설정 가능
- 사용자가 이메일 제공을 거부할 수 있음
- 이메일이 없으면 로그인 실패 가능

### 비즈니스 앱
- 이메일을 **필수 동의**로 설정 가능
- 사용자가 반드시 이메일을 제공해야 함
- 앱을 비즈니스 앱으로 전환해야 함

---

## 비즈니스 앱 전환 방법 (필수 동의가 필요한 경우)

1. **카카오 개발자 콘솔 접속**
2. **"내 애플리케이션"** > 앱 선택
3. **"앱 설정"** > **"앱 정보"** 메뉴
4. **"앱 유형"** 섹션에서 **"비즈니스 앱"** 선택
5. 비즈니스 인증 정보 입력 (사업자 등록번호 등)
6. 인증 완료 후 동의 항목에서 **"필수 동의"** 설정 가능

---

## 현재 구현 상태

현재 백엔드 코드는 **이메일이 필수**로 구현되어 있습니다:

- `CustomOAuth2UserService`에서 이메일이 없으면 예외 발생
- 에러 메시지: "카카오 로그인 시 이메일 제공에 동의해주세요."

따라서 **방법 1 (동의 항목 활성화)**을 권장합니다.

---

## 참고 자료

- [카카오 로그인 REST API 가이드](https://developers.kakao.com/docs/latest/ko/kakaologin/rest-api)
- [카카오 로그인 동의 항목 설정](https://developers.kakao.com/docs/latest/ko/kakaologin/common#user-info)
- [카카오 데브톡 - 동의 항목 설정](https://devtalk.kakao.com/t/how-to-set-scopes-to-required-consent/115162)
