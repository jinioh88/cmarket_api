services:
  # Redis 서비스 (외부 접근 허용 설정 추가)
  # Spring Boot가 EC2 호스트에서 실행 중이므로 Redis 포트를 외부로 노출해야 합니다.
  redis:
    image: redis:latest
    container_name: cmarket-redis
    restart: always
    ports:
      - "6379:6379"  # EC2 호스트에서 접속 가능하도록 포트 노출
    networks:
      - cmarket-network

  # app 서비스는 현재 jar를 EC2 호스트에서 직접 실행 중이므로 주석 처리
  # Docker Compose로 실행할 경우 아래 주석을 해제하고 사용하세요.
  # app:
  #   build: .
  #   container_name: cmarket-api
  #   restart: always
  #   depends_on:
  #     - redis
  #   volumes:
  #     - ./h2data:/data
  #     - ./uploads:/data/uploads
  #   environment:
  #     - SPRING_PROFILES_ACTIVE=prod
  #     - OAUTH2_REDIRECT_URI=https://cuddle-market.duckdns.org/oauth-redirect
  #     - APP_IMAGE_SERVER_URL=https://cmarket-api.duckdns.org
  #     - FRONTEND_URL=https://cuddle-market.duckdns.org
  #   networks:
  #     - cmarket-network

volumes:
  redis-data:

networks:
  cmarket-network:
    driver: bridge
